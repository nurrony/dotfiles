#!/usr/bin/env bash

kctx() {
  kubectl-ctx $1
}

kns() {
  kubectl-ns $1
}

k8sgui() {
  local service_account=${1:-nurrony}
  shift
  echo "$@"
  kubectl proxy "$@" > /dev/null &; \
  kubectl --n kubernetes-dashboard get secret \
    $(kubectl --n kubernetes-dashboard get sa/$service_account -o jsonpath="{.secrets[0].name}") \
    -o go-template="{{.data.token | base64decode}}" | pbcopy && \
    echo '==> Token for ' $service_account 'is copid to clipboard and opened in browser...'
  open -n -u http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
}


dynamodb() {
  kubectl port-forward --namespace k8s-aws service/dynamodb ${1:-8000}:80 2>&1 >/dev/null &
}

K8S_SERVICE="Rancher Desktop"

if pgrep -xq -- "${K8S_SERVICE}"; then
  kctx k8s-ship
fi
